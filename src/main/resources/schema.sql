CREATE TABLE IF NOT EXISTS GENRE (
	GENRE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME VARCHAR(40) NOT NULL,
	CONSTRAINT GENRE_PK PRIMARY KEY (GENRE_ID)
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_4 ON PUBLIC.GENRE (GENRE_ID);

CREATE TABLE IF NOT EXISTS MPA_RATING (
    RATING_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	RATING_NAME VARCHAR(40) NOT NULL,
	CONSTRAINT MPA_RATING_PK PRIMARY KEY (RATING_ID)
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_44 ON PUBLIC.MPA_RATING (RATING_NAME);

CREATE TABLE IF NOT EXISTS PUBLIC.FILM (
	FILM_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME VARCHAR(40) NOT NULL,
	DESCRIPTION VARCHAR,
	RELEASE_DATE DATE NOT NULL,
	DURATION INTEGER,
	RATING_ID INTEGER NOT NULL,
	CONSTRAINT FILM_PK PRIMARY KEY (FILM_ID),
	CONSTRAINT FILM_FK FOREIGN KEY (RATING_ID) REFERENCES PUBLIC.MPA_RATING(RATING_ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);
CREATE INDEX IF NOT EXISTS FILM_FK_INDEX_2 ON PUBLIC.FILM (RATING_ID);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_2 ON PUBLIC.FILM (FILM_ID);

CREATE TABLE IF NOT EXISTS PUBLIC.FILM_GENRE (
	FILM_GENRE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	FILM_ID INTEGER NOT NULL,
	GENRE_ID INTEGER NOT NULL,
	CONSTRAINT FILM_GENRE_PK PRIMARY KEY (FILM_GENRE_ID),
	CONSTRAINT FILM_GENRE_FK FOREIGN KEY (GENRE_ID) REFERENCES PUBLIC.GENRE(GENRE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FILM_GENRE_FK_1 FOREIGN KEY (FILM_ID) REFERENCES PUBLIC.FILM(FILM_ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);
CREATE INDEX IF NOT EXISTS FILM_GENRE_FK_1_INDEX_7 ON PUBLIC.FILM_GENRE (FILM_ID);
CREATE INDEX IF NOT EXISTS FILM_GENRE_FK_INDEX_7 ON PUBLIC.FILM_GENRE (GENRE_ID);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_7 ON PUBLIC.FILM_GENRE (FILM_GENRE_ID);

CREATE TABLE IF NOT EXISTS "USER" (
	USER_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	EMAIL VARCHAR(40) NOT NULL,
	LOGIN VARCHAR(40) NOT NULL,
	NAME VARCHAR(100) NOT NULL,
	BIRTHDAY DATE NOT NULL,
	CONSTRAINT USER_PK PRIMARY KEY (USER_ID)
);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_3 ON PUBLIC."USER" (USER_ID);

CREATE TABLE IF NOT EXISTS PUBLIC.FRIEND_REQUEST (
	FRIEND_REQUEST_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	INITIATOR_USER_ID INTEGER NOT NULL,
	TARGET_USER_ID INTEGER NOT NULL,
	CONFIRMED BOOLEAN DEFAULT FALSE,
	CONSTRAINT FRIEND_REQUEST_PK PRIMARY KEY (FRIEND_REQUEST_ID),
	CONSTRAINT FRIEND_REQUEST_FK FOREIGN KEY (INITIATOR_USER_ID) REFERENCES PUBLIC."USER"(USER_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT FRIEND_REQUEST_FK_1 FOREIGN KEY (TARGET_USER_ID) REFERENCES PUBLIC."USER"(USER_ID) ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE INDEX IF NOT EXISTS FRIEND_REQUEST_FK_1_INDEX_4 ON PUBLIC.FRIEND_REQUEST (TARGET_USER_ID);
CREATE INDEX IF NOT EXISTS FRIEND_REQUEST_FK_INDEX_4 ON PUBLIC.FRIEND_REQUEST (INITIATOR_USER_ID);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_45 ON PUBLIC.FRIEND_REQUEST (FRIEND_REQUEST_ID);

CREATE TABLE IF NOT EXISTS PUBLIC.LIKES (
	LIKE_ID INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	USER_ID INTEGER NOT NULL,
	FILM_ID INTEGER NOT NULL,
	CONSTRAINT LIKES_PK PRIMARY KEY (LIKE_ID),
	CONSTRAINT LIKES_FK FOREIGN KEY (USER_ID) REFERENCES PUBLIC."USER"(USER_ID) ON DELETE RESTRICT ON UPDATE RESTRICT,
	CONSTRAINT LIKES_FK_1 FOREIGN KEY (FILM_ID) REFERENCES PUBLIC.FILM(FILM_ID) ON DELETE RESTRICT ON UPDATE RESTRICT
);
CREATE INDEX IF NOT EXISTS LIKES_FK_1_INDEX_4 ON PUBLIC.LIKES (FILM_ID);
CREATE INDEX IF NOT EXISTS LIKES_FK_INDEX_4 ON PUBLIC.LIKES (USER_ID);
CREATE UNIQUE INDEX IF NOT EXISTS PRIMARY_KEY_451 ON PUBLIC.LIKES (LIKE_ID);